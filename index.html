<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BIZARRE VIEW</title>

    <style>
      :root {
        --bg: #0b0d12;
        --fg: #e8e9ec;
        --muted: #9aa0aa;
        --accent: #5da9ff;
        --accent-strong: #3b7dff;
        --card: #151923;
        --card-soft: rgba(255, 255, 255, 0.04);
        --border: rgba(255, 255, 255, 0.08);
        --radius: 12px;
        --ease: cubic-bezier(0.2, 0.8, 0.2, 1);
      }

      * {
        box-sizing: border-box;
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          sans-serif;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        margin: 0;
        background:
          radial-gradient(1200px 600px at 20% -10%, #16203a, transparent),
          var(--bg);
        color: var(--fg);
      }

      /* ================= HEADER ================= */

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 20px;
        border-bottom: 1px solid var(--border);
        backdrop-filter: blur(8px);
        animation: fadeIn 0.6s var(--ease);
      }

      header a {
        font-weight: 600;
        letter-spacing: 0.3px;
      }

      /* ================= CONTROLS ================= */

      form {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        padding: 16px;
        background: rgba(0, 0, 0, 0.35);
        border-bottom: 1px solid var(--border);
        animation: fadeIn 0.6s 0.1s both var(--ease);
      }

      input,
      select,
      button {
        background: var(--card);
        color: var(--fg);
        border: 1px solid var(--border);
        padding: 9px 12px;
        border-radius: var(--radius);
        font-size: 14px;
        min-height: 38px;
        transition: all 0.25s var(--ease);
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(93, 169, 255, 0.15);
      }

      button {
        cursor: pointer;
        background: linear-gradient(
          135deg,
          var(--accent),
          var(--accent-strong)
        );
        border: none;
        color: #02040a;
        font-weight: 600;
        padding: 0 18px;
      }

      button:hover {
        transform: translateY(-2px);
        filter: brightness(1.1);
      }

      button:active {
        transform: translateY(0) scale(0.96);
      }

      button.secondary {
        background: var(--card);
        border: 1px solid var(--border);
        color: var(--fg);
      }

      /* ================= GALLERY ================= */

      #grid {
        padding: 18px;
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
      }

      .card {
        background:
          linear-gradient(180deg, var(--card-soft), transparent), var(--card);
        border-radius: var(--radius);
        overflow: hidden;
        width: 160px;
        display: flex;
        flex-direction: column;
        position: relative;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        transition:
          transform 0.35s var(--ease),
          box-shadow 0.35s var(--ease);
        animation: cardEnter 0.5s var(--ease);
      }

      .card:hover {
        transform: translateY(-6px);
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
      }

      .card img {
        width: 100%;
        display: block;
        transition:
          transform 0.5s var(--ease),
          filter 0.5s var(--ease);
      }

      .card:hover img {
        transform: scale(1.06);
      }

      .card .info {
        padding: 8px 10px;
        display: flex;
        justify-content: space-between;
        font-size: 11px;
        color: var(--muted);
      }

      .card a {
        color: var(--accent);
        text-decoration: none;
        transition: opacity 0.2s;
      }

      .card a:hover {
        opacity: 0.8;
      }

      /* ================= BLUR FEATURE ================= */

      .blur-on .card img {
        filter: blur(6px) saturate(0.9);
        transform: scale(1.05);
      }

      .blur-on .card:hover img {
        filter: blur(0);
      }

      #blurToggle {
        padding: 0 14px;
        height: 32px;
        border-radius: 999px;
        cursor: pointer;
        transition: all 0.3s var(--ease);
      }

      #blurToggle.active {
        background: linear-gradient(
          135deg,
          var(--accent),
          var(--accent-strong)
        );
        color: #02040a;
      }

      /* ================= FOOTER ================= */

      footer {
        padding: 14px 18px;
        display: flex;
        justify-content: space-between;
        border-top: 1px solid var(--border);
        background: rgba(0, 0, 0, 0.35);
        animation: fadeIn 0.6s 0.2s both var(--ease);
      }

      footer span {
        font-size: 13px;
        color: var(--muted);
      }

      /* ================= EXPAND OVERLAY ================= */

      .expand-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.75);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.35s var(--ease);
        z-index: 9999;
      }

      .expand-overlay.visible {
        opacity: 1;
        pointer-events: auto;
      }

      .expanded-card {
        background: var(--card);
        border-radius: 18px;
        width: min(900px, 90vw);
        max-height: 90vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 50px 140px rgba(0, 0, 0, 0.7);
        transform: scale(0.8);
        opacity: 0;
        transition:
          transform 0.5s var(--ease),
          opacity 0.5s var(--ease);
      }

      .expand-overlay.visible .expanded-card {
        transform: scale(1);
        opacity: 1;
      }

      .expanded-card img {
        width: 100%;
        max-height: 50vh;
        object-fit: cover;
        transition: opacity 0.4s var(--ease);
      }

      /* ================= EXPANDED CONTENT ================= */

      .expanded-content {
        padding: 16px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
        font-size: 13px;
      }

      .meta-row {
        display: flex;
        justify-content: space-between;
        color: var(--muted);
        opacity: 0;
        transform: translateY(8px);
        animation: fadeUp 0.4s forwards var(--ease);
      }

      .meta-row:nth-child(1) {
        animation-delay: 0.05s;
      }
      .meta-row:nth-child(2) {
        animation-delay: 0.1s;
      }
      .meta-row:nth-child(3) {
        animation-delay: 0.15s;
      }
      .meta-row:nth-child(4) {
        animation-delay: 0.2s;
      }
      .meta-row:nth-child(5) {
        animation-delay: 0.25s;
      }

      .color-strip {
        display: flex;
        gap: 6px;
      }

      .color-block {
        width: 20px;
        height: 20px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: transform 0.3s var(--ease);
      }

      .color-block-active {
        width: 20px;
        height: 20px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: transform 0.3s var(--ease);
        transform: scale(1.2);
      }

      .color-block:hover {
        transform: scale(1.2);
      }

      /* ================= TAGS ================= */

      .tag-list {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .tag {
        background: var(--card-soft);
        border: 1px solid var(--border);
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 11px;
        cursor: pointer;
        user-select: none;
        transition: all 0.25s var(--ease);
      }

      .tag:hover {
        background: var(--accent);
        color: #02040a;
        transform: translateY(-2px);
      }

      .tag:active {
        transform: scale(0.9);
      }

      .tag.active {
        background: linear-gradient(
          135deg,
          var(--accent),
          var(--accent-strong)
        );
        color: #02040a;
        border: none;
      }

      /* ---------------- Help Modal Content ---------------- */

      #helpOverlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.7);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity .35s var(--ease);
        z-index: 999;
      }

      .helpModal h2 {
        margin: 0 0 6px;
        font-size: 20px;
      }

      .helpModal .intro {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 20px;
      }

      .helpModal section {
        margin-bottom: 18px;
      }

      .helpModal h3 {
        margin: 0 0 6px;
        font-size: 14px;
        color: var(--accent);
        letter-spacing: 0.3px;
      }

      .helpModal p {
        margin: 0 0 8px;
        font-size: 13px;
        color: var(--fg);
      }

      .helpModal code {
        background: rgba(255, 255, 255, 0.06);
        padding: 2px 6px;
        border-radius: 6px;
        font-size: 12px;
      }
    
      #helpOverlay.visible {
        opacity: 1;
        pointer-events: auto;
      }

      .helpModal {
        background: var(--card);
        min-width: 900px;
        max-height: 80vh;
        overflow: auto;
        padding: 24px;
        border-radius: 18px;
        box-shadow: 0 40px 100px rgba(0, 0, 0, 0.6);
        transform: translateY(20px);
        opacity: 0;
        transition: all 0.4s var(--ease);
      }

      #helpOverlay.visible .helpModal {
        transform: translateY(0);
        opacity: 1;
      }






      #helpOverlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 999;
      }

      .helpModal {
        background: var(--card);
        max-width: 900px;
        max-height: 80vh;
        overflow: auto;
        padding: 20px;
        border-radius: 14px;
        position: relative;
        box-shadow: 0 40px 100px rgba(0, 0, 0, 0.6);
      }

      .helpModal .close {
        position: absolute;
        top: 10px;
        right: 14px;
        background: none;
        border: none;
        color: var(--fg);
        font-size: 22px;
        cursor: pointer;
      }

      .api-grid-search {
        display: flex;
        flex-direction: column;
        gap: 10px;
        font-size: 13px;
      }

      .api-grid-search > span {
        display: flex;
      }

      .api-grid-search > span > span,
      .api-grid-search > span > ul {
        flex: 1;
      }

      .api-grid-search .header {
        font-weight: 600;
        color: var(--accent);
      }

      .api-grid-search ul {
        padding-left: 16px;
        margin: 0;
      }

      .recs {
        margin-top: 24px;
        font-size: 13px;
        color: var(--muted);
      }

      .recs a {
        color: var(--accent);
      }

            .helpModal h2 {
        margin: 0 0 6px;
        font-size: 20px;
      }

      .helpModal .intro {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 20px;
      }

      .helpModal section {
        margin-bottom: 18px;
      }

      .helpModal h3 {
        margin: 0 0 6px;
        font-size: 14px;
        color: var(--accent);
        letter-spacing: 0.3px;
      }

      .helpModal p {
        margin: 0 0 8px;
        font-size: 13px;
        color: var(--fg);
      }

      .helpModal code {
        background: rgba(255, 255, 255, 0.06);
        padding: 2px 6px;
        border-radius: 6px;
        font-size: 12px;
      }

      /* Chips */

      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 0;
        margin: 6px 0 0;
        list-style: none;
      }

      .chips li {
        background: var(--card-soft);
        border: 1px solid var(--border);
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      /* Color dots */

      .color-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--c);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      /* Footer link */

      .recs {
        margin-top: 24px;
        font-size: 13px;
        color: var(--muted);
      }

      .recs a {
        color: var(--accent);
        text-decoration: none;
      }

      .recs a:hover {
        text-decoration: underline;
      }

      .title-link {
        color: inherit;
        text-decoration: none;
        cursor: pointer;
        display: inline-block;
      }

      .title-link:visited, 
      .title-link:hover, 
      .title-link:active {
        color: inherit;
        text-decoration: none;
      }
      /* ================= ANIMATIONS ================= */

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes cardEnter {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>

  <body>
    <header>
      <div>
        <a class="title-link" href="https://the-speedwagon-foundation.github.io/">BIZARRE VIEW</a>
        <svg
          width="32"
          height="32"
          version="1.1"
          id="Layer_1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          x="0px"
          y="0px"
          viewBox="0 0 512 512"
          enable-background="new 0 0 512 512"
          xml:space="preserve"
        >
          <g>
            <linearGradient
              id="SVGID_1_"
              gradientUnits="userSpaceOnUse"
              x1="302.1712"
              y1="128.7627"
              x2="414.2205"
              y2="-4.7723"
            >
              <stop offset="0" style="stop-color: #a9447c" />
              <stop offset="0.3706" style="stop-color: #713068" />
              <stop offset="1" style="stop-color: #0b0c44" />
            </linearGradient>
            <path
              fill="url(#SVGID_1_)"
              stroke="#000000"
              stroke-width="7"
              d="M276.8,107.5c19,5.7,39.7,11.7,51.8,14.1   C361.7,86.1,424,28.5,444,20.3C418.8,12.5,386.6,7.4,365.2,6C341.6,23.5,295.5,68.3,276.8,107.5z"
            />
            <linearGradient
              id="SVGID_2_"
              gradientUnits="userSpaceOnUse"
              x1="382.7103"
              y1="151.2625"
              x2="473.6362"
              y2="42.9013"
            >
              <stop offset="0" style="stop-color: #a9447c" />
              <stop offset="0.3706" style="stop-color: #713068" />
              <stop offset="1" style="stop-color: #0b0c44" />
            </linearGradient>
            <path
              fill="url(#SVGID_2_)"
              stroke="#000000"
              stroke-width="7"
              d="M357.1,126.9c3.4,6,32.2,32.2,40,31.5   c34.2-16.6,89.9-67.8,101-95c-11.4-9.2-27.5-19-38-20.9C434.7,58.1,371.2,108.1,357.1,126.9z"
            />
            <linearGradient
              id="SVGID_3_"
              gradientUnits="userSpaceOnUse"
              x1="35.3239"
              y1="519.665"
              x2="344.0546"
              y2="151.7341"
            >
              <stop offset="0" style="stop-color: #b84882" />
              <stop offset="0.342" style="stop-color: #80356e" />
              <stop offset="1" style="stop-color: #0c0d45" />
            </linearGradient>
            <path
              fill="url(#SVGID_3_)"
              stroke="#000000"
              stroke-width="7"
              d="M52.9,390.3c-14.3,27-50.6,89.2-35.3,114.4   c3.9,6.5,65.1-11.9,131.8-26.9c46.6-10.4,96.4-24.1,125.2-28.1c11.5-1.6,28.5-26.4,29.4-45c1.2-25.3-0.8-147.8,35.6-223.6   c6-10.1,4.1-29.6-2.7-35.4c-8-6.8-20.2-10.5-42.5-3.5c-14.7,4.6-117.8,57-122.8,53.7c-3.2-2.1,9.9-58.8,11.5-70.6   c-26.3,29.1-164.5,180.1-142.6,202c14.8,14.8,153.9-80.5,185.7-75.9c14.9,2.1,16.9,10.4,16.2,21.4c-1.9,13.7-15.6,100.4-18.1,114.1   C167.5,388,79.9,388.9,52.9,390.3z"
            />
          </g>
        </svg>
        <svg
          width="32"
          height="32"
          version="1.1"
          id="Layer_1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          x="0px"
          y="0px"
          viewBox="0 0 512 512"
          enable-background="new 0 0 512 512"
          xml:space="preserve"
        >
          <g>
            <linearGradient
              id="SVGID_1_"
              gradientUnits="userSpaceOnUse"
              x1="302.1712"
              y1="128.7627"
              x2="414.2205"
              y2="-4.7723"
            >
              <stop offset="0" style="stop-color: #a9447c" />
              <stop offset="0.3706" style="stop-color: #713068" />
              <stop offset="1" style="stop-color: #0b0c44" />
            </linearGradient>
            <path
              fill="url(#SVGID_1_)"
              stroke="#000000"
              stroke-width="7"
              d="M276.8,107.5c19,5.7,39.7,11.7,51.8,14.1   C361.7,86.1,424,28.5,444,20.3C418.8,12.5,386.6,7.4,365.2,6C341.6,23.5,295.5,68.3,276.8,107.5z"
            />
            <linearGradient
              id="SVGID_2_"
              gradientUnits="userSpaceOnUse"
              x1="382.7103"
              y1="151.2625"
              x2="473.6362"
              y2="42.9013"
            >
              <stop offset="0" style="stop-color: #a9447c" />
              <stop offset="0.3706" style="stop-color: #713068" />
              <stop offset="1" style="stop-color: #0b0c44" />
            </linearGradient>
            <path
              fill="url(#SVGID_2_)"
              stroke="#000000"
              stroke-width="7"
              d="M357.1,126.9c3.4,6,32.2,32.2,40,31.5   c34.2-16.6,89.9-67.8,101-95c-11.4-9.2-27.5-19-38-20.9C434.7,58.1,371.2,108.1,357.1,126.9z"
            />
            <linearGradient
              id="SVGID_3_"
              gradientUnits="userSpaceOnUse"
              x1="35.3239"
              y1="519.665"
              x2="344.0546"
              y2="151.7341"
            >
              <stop offset="0" style="stop-color: #b84882" />
              <stop offset="0.342" style="stop-color: #80356e" />
              <stop offset="1" style="stop-color: #0c0d45" />
            </linearGradient>
            <path
              fill="url(#SVGID_3_)"
              stroke="#000000"
              stroke-width="7"
              d="M52.9,390.3c-14.3,27-50.6,89.2-35.3,114.4   c3.9,6.5,65.1-11.9,131.8-26.9c46.6-10.4,96.4-24.1,125.2-28.1c11.5-1.6,28.5-26.4,29.4-45c1.2-25.3-0.8-147.8,35.6-223.6   c6-10.1,4.1-29.6-2.7-35.4c-8-6.8-20.2-10.5-42.5-3.5c-14.7,4.6-117.8,57-122.8,53.7c-3.2-2.1,9.9-58.8,11.5-70.6   c-26.3,29.1-164.5,180.1-142.6,202c14.8,14.8,153.9-80.5,185.7-75.9c14.9,2.1,16.9,10.4,16.2,21.4c-1.9,13.7-15.6,100.4-18.1,114.1   C167.5,388,79.9,388.9,52.9,390.3z"
            />
          </g>
        </svg>
        <svg
          width="32"
          height="32"
          version="1.1"
          id="Layer_1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          x="0px"
          y="0px"
          viewBox="0 0 512 512"
          enable-background="new 0 0 512 512"
          xml:space="preserve"
        >
          <g>
            <linearGradient
              id="SVGID_1_"
              gradientUnits="userSpaceOnUse"
              x1="302.1712"
              y1="128.7627"
              x2="414.2205"
              y2="-4.7723"
            >
              <stop offset="0" style="stop-color: #a9447c" />
              <stop offset="0.3706" style="stop-color: #713068" />
              <stop offset="1" style="stop-color: #0b0c44" />
            </linearGradient>
            <path
              fill="url(#SVGID_1_)"
              stroke="#000000"
              stroke-width="7"
              d="M276.8,107.5c19,5.7,39.7,11.7,51.8,14.1   C361.7,86.1,424,28.5,444,20.3C418.8,12.5,386.6,7.4,365.2,6C341.6,23.5,295.5,68.3,276.8,107.5z"
            />
            <linearGradient
              id="SVGID_2_"
              gradientUnits="userSpaceOnUse"
              x1="382.7103"
              y1="151.2625"
              x2="473.6362"
              y2="42.9013"
            >
              <stop offset="0" style="stop-color: #a9447c" />
              <stop offset="0.3706" style="stop-color: #713068" />
              <stop offset="1" style="stop-color: #0b0c44" />
            </linearGradient>
            <path
              fill="url(#SVGID_2_)"
              stroke="#000000"
              stroke-width="7"
              d="M357.1,126.9c3.4,6,32.2,32.2,40,31.5   c34.2-16.6,89.9-67.8,101-95c-11.4-9.2-27.5-19-38-20.9C434.7,58.1,371.2,108.1,357.1,126.9z"
            />
            <linearGradient
              id="SVGID_3_"
              gradientUnits="userSpaceOnUse"
              x1="35.3239"
              y1="519.665"
              x2="344.0546"
              y2="151.7341"
            >
              <stop offset="0" style="stop-color: #b84882" />
              <stop offset="0.342" style="stop-color: #80356e" />
              <stop offset="1" style="stop-color: #0c0d45" />
            </linearGradient>
            <path
              fill="url(#SVGID_3_)"
              stroke="#000000"
              stroke-width="7"
              d="M52.9,390.3c-14.3,27-50.6,89.2-35.3,114.4   c3.9,6.5,65.1-11.9,131.8-26.9c46.6-10.4,96.4-24.1,125.2-28.1c11.5-1.6,28.5-26.4,29.4-45c1.2-25.3-0.8-147.8,35.6-223.6   c6-10.1,4.1-29.6-2.7-35.4c-8-6.8-20.2-10.5-42.5-3.5c-14.7,4.6-117.8,57-122.8,53.7c-3.2-2.1,9.9-58.8,11.5-70.6   c-26.3,29.1-164.5,180.1-142.6,202c14.8,14.8,153.9-80.5,185.7-75.9c14.9,2.1,16.9,10.4,16.2,21.4c-1.9,13.7-15.6,100.4-18.1,114.1   C167.5,388,79.9,388.9,52.9,390.3z"
            />
          </g>
        </svg>
      </div>

      <div style="display: flex; gap: 8px">
        <button id="blurToggle">Blur</button>
        <button id="helpBtn">?</button>
      </div>
    </header>

    <form id="searchForm">
      <input name="q" placeholder="Поиск" />

      <select name="categories">
        <option value="111">Все категории</option>
        <option value="100">Общее</option>
        <option value="010">Аниме</option>
        <option value="001">Люди</option>
      </select>

      <select name="sorting">
        <option selected value="toplist">Toplist</option>
        <option value="date_added">Date added</option>
        <option value="relevance">Relevance</option>
        <option value="views">Views</option>
        <option value="favorites">Favorites</option>
        <option value="random">Random</option>
      </select>

      <select name="topRange">
        <option value="1d">1d</option>
        <option value="3d">3d</option>
        <option value="1w">1w</option>
        <option selected value="1M">1M</option>
        <option value="3M">3M</option>
        <option value="6M">1y</option>
      </select>

      <input name="atleast" placeholder="Минимум (1920x1080)" />

      <select name="colors">
        <option selected value="">Все цвета</option>
        <option value="660000">DkRed</option>
        <option value="990000">Red</option>
        <option value="cc0000">Vivid Red</option>
        <option value="cc3333">Crimson</option>
        <option value="ea4c88">Rose</option>
        <option value="993399">Purple</option>
        <option value="663399">Violet</option>
        <option value="333399">Indigo</option>
        <option value="0066cc">Blue</option>
        <option value="0099cc">Sky Blue</option>
        <option value="66cccc">Turquoise</option>
        <option value="77cc33">Lime</option>
        <option value="669900">Olive</option>
        <option value="336600">DkGreen</option>
        <option value="666600">Drab</option>
        <option value="999900">Moss</option>
        <option value="cccc33">Mustard</option>
        <option value="ffff00">Yellow</option>
        <option value="ffcc33">Gold</option>
        <option value="ff9900">Orange</option>
        <option value="ff6600">Pumpkin</option>
        <option value="cc6633">Rust</option>
        <option value="996633">Tan</option>
        <option value="663300">Brown</option>
        <option value="000000">Black</option>
        <option value="999999">Gray</option>
        <option value="cccccc">LtGray</option>
        <option value="ffffff">White</option>
        <option value="424153">Charcoal</option>
      </select>

      <button type="submit">Поиск</button>
    </form>

    <div id="grid"></div>

    <footer>
      <button id="prev" class="secondary">← Prev</button>
      <span id="pageInfo">Page 1</span>
      <button id="next" class="secondary">Next →</button>
    </footer>

    <div id="helpOverlay">
      <div class="helpModal">
        <button class="close">×</button>

        <h2>Search tips</h2>
        <p class="intro">
          Fine-tune results using tags, filters and sorting. Most fields are
          optional.
        </p>

        <section>
          <h3>Query</h3>
          <p>Use keywords or tags to describe what you want.</p>
          <ul class="chips">
            <li><code>tag</code></li>
            <li><code>-exclude</code></li>
            <li><code>+required</code></li>
            <li><code>@user</code></li>
          </ul>
        </section>

        <section>
          <h3>Sorting</h3>
          <p><code>Toplist</code> works best with a time range.</p>
        </section>

        <section>
          <h3>Quality filters</h3>
          <p>Limit results by minimum resolution or dominant color.</p>
          <ul class="chips">
            <li><code>1920x1080</code></li>
            <li><span class="color-dot" style="--c: #0099cc"></span> Blue</li>
            <li><span class="color-dot" style="--c: #77cc33"></span> Lime</li>
            <li><span class="color-dot" style="--c: #ffffff"></span> White</li>
          </ul>
        </section>

        <section>
          <h3>Navigation</h3>
          <p>Use <b>Prev</b> / <b>Next</b> to move between pages.</p>
        </section>

        <div class="recs">
          <span>
            Extra inspiration →
            <a
              href="https://github.com/the-speedwagon-foundation/humanitarian-cargo/archive/refs/heads/main.zip"
              target="_blank"
            >
              Foundation recommendations
            </a>
          </span>
        </div>
      </div>
    </div>

    <div id="expandOverlay" class="expand-overlay"></div>

    <script>
      const API = "https://wallhaven.cc/api/v1/search";
      const PROXY = "https://proxy.vmlabs.su:3128/?url=";

      let currentPage = 1;
      let lastPage = 1;

      const form = document.getElementById("searchForm");
      const grid = document.getElementById("grid");
      const pageInfo = document.getElementById("pageInfo");
      const overlay = document.getElementById("expandOverlay");
      const helpOverlay = document.getElementById("helpOverlay");
      const blurToggle = document.getElementById("blurToggle");

      // ================= TAG HELPERS =================

      function getQueryTags() {
        return form.q.value
          .split(" ")
          .filter((t) => t.startsWith("+"))
          .map((t) => t.slice(1));
      }

      function getQueryColor() {
        return form.colors.value;
      }

      function toggleTag(tagName) {
        let parts = form.q.value.split(" ").filter(Boolean);
        const tag = `+${tagName}`;

        if (parts.includes(tag)) {
          parts = parts.filter((p) => p !== tag);
        } else {
          parts.push(tag);
        }

        form.q.value = parts.join(" ");
        fetchWallpapers(1);
      }

      function toggleColor(color) {
        if (color === getQueryColor()) {
          form.colors.value = ""
        } else {
          form.colors.value = color
        }

        fetchWallpapers(1);
      }

      // ================= FETCH =================

      async function fetchWallpapers(page = 1) {
        const data = new FormData(form);
        const params = new URLSearchParams();

        for (const [key, value] of data.entries()) {
          if (key === "colors" && value === "") continue;
          params.append(key, value);
        }

        params.append("purity", "SFW");
        params.append("page", page);

        const res = await fetch(`${PROXY}${API}?${params}`);
        const json = await res.json();

        grid.innerHTML = "";

        json.data.forEach((w) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
      <img src="${PROXY}${w.thumbs.small}">
      <div class="info">
        <span>${w.resolution}</span>
        <a href="${PROXY}${w.path}" download>
          ${w.path.split("-")[1]}
        </a>
      </div>
    `;

          card.onclick = () => openExpanded(w);
          grid.appendChild(card);
        });

        currentPage = json.meta.current_page;
        lastPage = json.meta.last_page;
        pageInfo.textContent = `Page ${currentPage} / ${lastPage}`;
      }

      // ================= EXPANDED =================

      async function openExpanded(w) {
        overlay.classList.add("visible");

        const container = document.createElement("div");
        container.className = "expanded-card";
        container.innerHTML = `
    <img src="${PROXY}${w.path}">
    <div class="expanded-content">
      <div>Loading...</div>
    </div>
  `;

        overlay.innerHTML = "";
        overlay.appendChild(container);

        const res = await fetch(
          `${PROXY}https://wallhaven.cc/api/v1/w/${w.id}`,
        );
        const data = (await res.json()).data;

        const content = container.querySelector(".expanded-content");

        content.innerHTML = `
    ${metaRow("Resolution", data.resolution)}
    ${metaRow("Views", data.views)}
    ${metaRow("Favorites", data.favorites)}
    ${metaRow("Uploader", data.uploader.username)}
    ${metaRow("Category", data.category)}
    ${metaRow("Created", data.created_at)}
    <div class="color-strip"></div>
    <div class="tag-list"></div>
  `;

        // Colors
        const colorStrip = content.querySelector(".color-strip");
        data.colors.forEach((c) => {
          const block = document.createElement("div");
          const currColor = getQueryColor();
          const newColor = c.slice(1);
          if (currColor === newColor) {
            block.className = "color-block-active";
          } else {
            block.className = "color-block";
          }
          
          block.style.background = c;
          block.onclick = (e) => {
            e.stopPropagation()
            toggleColor(newColor)
          }
          colorStrip.appendChild(block);
        });

        // Tags
        const activeTags = getQueryTags();
        const tagList = content.querySelector(".tag-list");

        data.tags.forEach((t, i) => {
          const tag = document.createElement("div");
          tag.className = "tag";
          tag.textContent = t.name;
          tag.style.animationDelay = `${i * 40}ms`;

          if (activeTags.includes(t.name)) {
            tag.classList.add("active");
          }

          tag.onclick = (e) => {
            e.stopPropagation();
            toggleTag(t.name);
            tag.classList.toggle("active");
          };

          tagList.appendChild(tag);
        });
      }

      function metaRow(label, value) {
        return `
    <div class="meta-row">
      <span>${label}</span>
      <span>${value}</span>
    </div>
  `;
      }

      // ================= NAVIGATION =================

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        fetchWallpapers(1);
      });

      document.getElementById("prev").onclick = () => {
        if (currentPage > 1) fetchWallpapers(currentPage - 1);
      };

      document.getElementById("next").onclick = () => {
        if (currentPage < lastPage) fetchWallpapers(currentPage + 1);
      };

      // ================= OVERLAYS =================

      overlay.onclick = (e) => {
        if (e.target === overlay) overlay.classList.remove("visible");
      };

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") overlay.classList.remove("visible");
      });

      document.getElementById("helpBtn").onclick = () => {
        helpOverlay.style.display = "flex";
        helpOverlay.classList.add("visible");
      }

      helpOverlay.onclick = (e) => {
        if (e.target === helpOverlay || e.target.classList.contains("close")) {
          helpOverlay.style.display = "none";
          helpOverlay.classList.remove("visible");
        }
      };

      // ================= BLUR =================

      let blurEnabled = localStorage.getItem("blur") === "1";
      document.body.classList.toggle("blur-on", blurEnabled);
      blurToggle.classList.toggle("active", blurEnabled);

      blurToggle.onclick = () => {
        blurEnabled = !blurEnabled;
        localStorage.setItem("blur", blurEnabled ? "1" : "0");
        document.body.classList.toggle("blur-on", blurEnabled);
        blurToggle.classList.toggle("active", blurEnabled);
      };

      // ================= INIT =================

      fetchWallpapers();
    </script>
  </body>
</html>
